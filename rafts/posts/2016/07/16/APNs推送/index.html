<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>APNs推送 – myzerone</title> <meta name="description" content="记录下自己学习的过程、点滴，也为了分享自己的收获。"> <meta name="keywords" content="iOS, APNs, 推送"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="/assets/img/logo.png"> <meta name="twitter:title" content="APNs推送"> <meta name="twitter:description" content="主要介绍APNs的推送机制，以及在iOS中如何实现APNs功能"> <!-- Open Graph --> <meta property="og:locale" content="zh_CN"> <meta property="og:type" content="article"> <meta property="og:title" content="APNs推送"> <meta property="og:description" content="主要介绍APNs的推送机制，以及在iOS中如何实现APNs功能"> <meta property="og:url" content="/posts/2016/07/16/APNs%E6%8E%A8%E9%80%81/"> <meta property="og:site_name" content="myzerone"> <meta property="og:image" content="/assets/img/logo.png"> <!-- Webmaster Tools verfication --> <meta name="google-site-verification" content="Oq-I-tGK8y1zoHLnZQnfe7rH6rkjqyjqZfBtvADe2uU"> <link rel="canonical" href="/posts/2016/07/16/APNs%E6%8E%A8%E9%80%81/"> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="myzerone Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- JS --> <script src="/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="/favicon.png"> <link rel="shortcut icon" href="/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <!-- 首页 --> <li> <a href="/">首页</a> </li> <!-- 关于 --> <li> <a href="#">关于</a> <ul class="dl-submenu"> <li> <img src="/assets/img/logo.png" alt="myzerone photo" class="author-photo"> <h4>myzerone</h4> <p>记录下自己学习的过程、点滴，也为了分享自己的收获。</p> </li> <li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:myzerone@myzerone.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://github.com/myzerone" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <!-- 博客 --> <li> <a href="#">博客</a> <ul class="dl-submenu"> <li><a href="/posts/">博客</a></li> <li><a href="/tags/">标签</a></li> </ul> </li> <!-- 随笔 --> <li> <a href="/notes/" rel="noopener noreferrer">随笔</a> </li> <!-- 项目 --> <li> <a href="/projects/" rel="noopener noreferrer">项目</a> </li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>APNs推送</h1> <h4>16 Jul 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~1 minute </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="id-override">Override</h1> <p>远程推送通知，就是从远程服务器图推送给客户端的通知，需要联网，又称为APNs(Apple Push Notification Services)。</p> <ol> <li>所有的苹果设备，在联网状态下，都会与苹果的服务器建立长连接，即只要联网了，就一直保持连接。</li> <li>长连接的作用有：时间校准、系统升级、查找我的iPhone。</li> <li>长连接的好处，数据传输速度快、数据保持最新状态。</li> </ol> <h1 id="id-apns">APNs的推送机制</h1> <p>与Android上我们自己实现的推送服务不同，Apple对设备的控制非常严格，消息推送的流程必须要经过APNs：</p> <p><img src="/assets/posts/APNS/remote_notif_simple.png" alt="remote_notif_simple"></p> <p><strong>Provider</strong> 表示发出通知的后台服务器，<strong>APNs</strong> 是Apple Push Notification Service的缩写，是苹果的推送服务器。<strong>Client App</strong> 是我们开发的App。</p> <p>从上图中可看出，应用收到通知，分为三步：</p> <ol> <li>应用程序的服务器端把要发送的消息、目的Apple设备的唯一标识打包，发给APNs。</li> <li>APNs在自身的已注册Push服务的应用列表中，查找有相应标识的设备，并把消息发送到设备。</li> <li>iOS系统把发来的消息传递给相应的应用程序，并且按照设定弹出Push通知。</li> </ol> <p>要想实现消息推送，有两点非常重要：</p> <ol> <li> <p>App的推送证书</p> <p>要能够完整实现一条消息推送，需要我们在App ID中打开Push Notifications，需要我们准备好Provisioning Profile和SSL证书，并且一定要注意Development和Distribution环境是需要分开的。最后，把SSL证书导入到服务器平台，就可以尝试远程消息推送了。具体的操作流程如下。</p> </li> <li> <p>设备标识DeviceToken</p> <p>知道了谁要推送，或者说要推送给哪个App之后，APNs还需要知道推到哪台设备上，这就是设备标识的作用。获取设备标识的流程如下：</p> <p><img src="/assets/posts/APNS/earn_device_token.png" alt="remote_notif_simple"></p> </li> </ol> <h2 id="id-apns-1">APNs推送通知的详细工作流程</h2> <p><img src="/assets/posts/APNS/remote_nofit_flow.png" alt="remote_nofit_flow"></p> <p>主要步骤如下： 1. App注册APNs消息推送功能 2. iOS从APNs服务器上获取到DeviceToken，App接收DeviceToken。 3. App将DeviceToken保存到后台服务器中 4. 当某些特定事件发生时，后台服务器就会给APNs服务器发送一条推送消息 5. APNs再将消息推送给目的设备，然后推送给App</p> <h1 id="id-apns-2">APNs具体实现步骤</h1> <p>APNs服务器通过DeviceToken找到我们的设备应用，然后推送消息。而DeviceToken需要配置推送证书才可以获得，而推送证书需要知道我们的App ID（App的BundleID，应用的唯一标识）和UDID（设备唯一标识），还有自己的服务器的UDID。 另外，因模拟器不支持推送，所以我们需要一台苹果的设备，iPhone、iPad或iPod。</p> <h2 id="id-csr">一、CSR文件</h2> <p>在开发证书、生产证书以及APNs推送证书的配置过程中，都会用到Certificate Signing Request（也就是CSR）文件。CSR文件的生成不分先后，可以在需要的时候在生成。</p> <p>首先，找到Mac应用程序里的 <strong>钥匙串访问.app</strong> ，打开。</p> <p><img src="/assets/posts/APNS/keychain_app.png" alt="keychain_app"></p> <p>选择从证书颁发机构请求证书</p> <p><img src="/assets/posts/APNS/keychain_request.png" alt="keychain_request"></p> <p>填上你的邮箱和常用名，可以随便写，<strong>常用名</strong> 要记一下，会用到，选择保存到磁盘。</p> <p><img src="/assets/posts/APNS/keychain_info.png" alt="keychain_info"></p> <p>继续，选择存储位置。</p> <p><img src="/assets/posts/APNS/keychain_savepath.png" alt="keychain_savepath"></p> <p>点击完成。</p> <p><img src="/assets/posts/APNS/keychain_over.png" alt="keychain_over"></p> <p>生成后的CSR文件如下：</p> <p><img src="/assets/posts/APNS/keychain_apns.png" alt="keychain_apns"></p> <h2 id="id-apns-3">二、APNs推送证书</h2> <p>首先登陆进入<a href="https://developer.apple.com/membercenter/index.action">Apple的开发者中心</a>，选择证书模块。</p> <p><img src="/assets/posts/APNS/Apple_developer_center.png" alt="Apple_developer_center"></p> <p>点击iOS Apps的证书（Certificates）。</p> <p><img src="/assets/posts/APNS/iOS_App_Certificates.png" alt="iOS_App_Certificates"></p> <p>进入后选择App IDs。</p> <p><img src="/assets/posts/APNS/apns_app_id.png" alt="apns_app_id"></p> <p>打开我们需要启用APNs服务的App ID。如果不存在则点击右上角的“＋”号创建App ID，创建App ID的流程可参考其它文章，不在此文介绍列。</p> <p><img src="/assets/posts/APNS/apns_app_id_info.png" alt="apns_app_id_info"></p> <p>发现Push Notifications是<code class="highlighter-rouge">Disabled</code>或<code class="highlighter-rouge">Configurable</code>时，点击Edit，找到推送模块，配送证书。</p> <p><img src="/assets/posts/APNS/APNS_dev_pro.png" alt="APNS_dev_pro"></p> <p>点击 <em>Create Certificate…</em> 按钮，进入下一界面，告诉我们需要一个CSR文件（就是上一节通过钥匙串生成的CSR文件 <em>APNS.certSigningRequest</em> ），意思就是让我们的MAC具有调试推送的权限.</p> <p><img src="/assets/posts/APNS/APNS_CSR_About.png" alt="APNS_CSR_About"></p> <p>点击继续。</p> <p><img src="/assets/posts/APNS/APNS_CSR_will.png" alt="APNS_CSR_will"></p> <p>选择 <em>Choose File…</em> 按钮上传我们上面生成的CSR文件(APNS.certSigningRequest)。</p> <p><img src="/assets/posts/APNS/APNS_CSR_upload.png" alt="APNS_CSR_upload"></p> <p>上传以后点击 <em>Generate</em> 按钮生成APNs推送证书。</p> <p><img src="/assets/posts/APNS/APNS_Generate.png" alt="APNS_Generate"></p> <p>到这里证书就配置好了，点击 <em>Download</em> 下载证书，<em>Done</em> 完成配置，或者点击 <em>Add Another</em> 继续添加APNs推送证书。也可以从Certificates-&gt;Development/Production中找到配置好的APNs推送证书，在下载下来。</p> <p><img src="/assets/posts/APNS/APNS_download.png" alt="APNS_download"></p> <p>双击打开我们下载下来的APNs推送证书。</p> <p><img src="/assets/posts/APNS/APNS_double_click.png" alt="APNS_double_click"></p> <p>打开以后，就可以在钥匙串中找到我们的证书了。</p> <p><img src="/assets/posts/APNS/APNS_keychain.png" alt="APNS_keychain"></p> <h2 id="id-section">三、导出密钥</h2> <p>打开钥匙串访问，找到我们生产的专用秘钥专用秘钥的名称就是我们在最开始生成CSR请求的时候填写的常用名）。</p> <p><img src="/assets/posts/APNS/APNS_keychain_special.png" alt="APNS_keychain_special"></p> <p>右键选择导出，输入导出名称为<code class="highlighter-rouge">APNS</code>：</p> <p><img src="/assets/posts/APNS/APNS_keychain_export.png" alt="APNS_keychain_export"></p> <p>在这里需要输入一个密码来对文件进行加密。这个密码必须要铭记，切记！</p> <p><img src="/assets/posts/APNS/APNS_keychain_export_pwd.png" alt="APNS_keychain_export_pwd"></p> <p>然后输入你电脑的密码，点击允许。</p> <p><img src="/assets/posts/APNS/APNS_keychain_export_mac_pwd.png" alt="APNS_keychain_export_mac_pwd"></p> <p>这样我们就在桌面上生成了一个APNS.p12文件。</p> <p><img src="/assets/posts/APNS/APNS_keychain_export_p12.png" alt="APNS_keychain_export_p12"></p> <h2 id="id-apns-4">四、APNs推送调试</h2> <p>推送证书都配置好以后，为了保险起见，我还需要进行真机调试APNs。真机调试需要保证App的Bundle ID与APNs的App ID保持一致。然后就是在<code class="highlighter-rouge">AppDelegate.m</code>中注册推送，然后可以借用一些工具测试我们的推送。如果操作正确，那么手机将会收到推送。推送可能会有一点延迟，请耐心等待。如果始终没有收到消息，那么需要你检查一下各个环节的配置是否正确。如果各个环节没有问题，但是仍没有收到消息，那么请看一下下面的主意事项：</p> <ul> <li>推送的测试工具的Device Token与<code class="highlighter-rouge">AppDelegate.m</code>中注册的Device Token是否一致</li> <li>设置完APNs后，有没有重新生成Provisioning证书</li> <li>重新生成Provisioning证书以后，把该证书更新的我们的Mac上（最好先把之前的Provisioning证书全部删除，防止出错）</li> <li>网络环境是否可以连接Apple的推送服务</li> <li>企业证书打包的App，需要生产环境才能收到APNs推送</li> </ul> <h2 id="id-section-1">五、注册推送</h2> <p>iOS8以前的版本注册通知方式：</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="n">UIRemoteNotificationType</span> <span class="n">notificationTypes</span> <span class="o">=</span> <span class="n">UIRemoteNotificationTypeBadge</span> <span class="o">|</span> <span class="n">UIRemoteNotificationTypeSound</span> <span class="o">|</span> <span class="n">UIRemoteNotificationTypeAlert</span><span class="p">;</span>
<span class="p">[[</span><span class="n">UIApplication</span> <span class="nf">sharedApplication</span><span class="p">]</span> <span class="nf">registerForRemoteNotificationTypes</span><span class="p">:</span><span class="n">notificationTypes</span><span class="p">];</span>
</code></pre></div> <p>iOS8及以后的APNs注册分为两步，且有两个方法需要调用：</p> <p>方法一：<code class="highlighter-rouge">registerForRemoteNotifications</code>方法没有参数，根据苹果的文档说明，该方法调用成功将会回调方法<code class="highlighter-rouge">application:didRegisterForRemoteNotificationsWithDeviceToken:</code>，失败回调<code class="highlighter-rouge">application:didFailToRegisterForRemoteNotificationsWithError:</code>。从中可以看出，该方法只是为了获取 <strong>deviceToken</strong> 。苹果可能考虑到一些应用注册提醒只是为乐获取 <strong>deviceToken</strong> ，所以单独提出了一个方法。</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="p">[[</span><span class="n">UIApplication</span> <span class="nf">sharedApplication</span><span class="p">]</span> <span class="nf">registerForRemoteNotifications</span><span class="p">];</span>
</code></pre></div> <p>方法二：<code class="highlighter-rouge">registerUserNotificationSettings：</code>方法才是真正用于注册接受推送消息的，需要设置参数。</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="n">UIUserNotificationSettings</span> <span class="o">*</span><span class="n">settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIUserNotificationSettings</span> <span class="nf">settingsForTypes</span><span class="p">:</span> <span class="p">(</span><span class="n">UIRemoteNotificationTypeBadge</span> <span class="o">|</span> <span class="n">UIRemoteNotificationTypeAlert</span> <span class="o">|</span> <span class="n">UIRemoteNotificationTypeSound</span><span class="p">)</span> <span class="nf">categories</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">[[</span><span class="n">UIApplication</span> <span class="nf">sharedApplication</span><span class="p">]</span> <span class="nf">registerUserNotificationSettings</span><span class="p">:</span><span class="n">settings</span><span class="p">];</span>
</code></pre></div> <p>完整的注册方法：</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="n">UIUserNotificationType</span> <span class="n">notificationTypes</span> <span class="o">=</span> <span class="n">UIUserNotificationTypeBadge</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeSound</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeAlert</span><span class="p">;</span>
<span class="n">UIUserNotificationSettings</span> <span class="o">*</span><span class="n">settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIUserNotificationSettings</span> <span class="nf">settingsForTypes</span><span class="p">:</span><span class="n">notificationTypes</span> <span class="nf">categories</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">[[</span><span class="n">UIApplication</span> <span class="nf">sharedApplication</span><span class="p">]</span> <span class="nf">registerUserNotificationSettings</span><span class="p">:</span><span class="n">settings</span><span class="p">];</span>
<span class="p">[[</span><span class="n">UIApplication</span> <span class="nf">sharedApplication</span><span class="p">]</span> <span class="nf">registerForRemoteNotifications</span><span class="p">];</span>

</code></pre></div> <p>兼容iOS8以前和iOS8及iOS以后的注册通知的代码：</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="n">UIApplication</span> <span class="o">*</span><span class="n">application</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIApplication</span> <span class="nf">sharedApplication</span><span class="p">];</span>

<span class="k">if</span><span class="p">([</span><span class="n">application</span> <span class="nf">respondsToSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nf">registerUserNotificationSettings</span><span class="p">:)])</span> <span class="p">{</span>
	  <span class="n">UIUserNotificationType</span> <span class="n">notificationTypes</span> <span class="o">=</span> <span class="n">UIUserNotificationTypeBadge</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeSound</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeAlert</span><span class="p">;</span>
    <span class="n">UIUserNotificationSettings</span> <span class="o">*</span><span class="n">settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIUserNotificationSettings</span> <span class="nf">settingsForTypes</span><span class="p">:</span><span class="n">notificationTypes</span> <span class="nf">categories</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>

		<span class="p">[</span><span class="n">application</span> <span class="nf">registerUserNotificationSettings</span><span class="p">:</span><span class="n">settings</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">([</span><span class="n">application</span> <span class="nf">respondsToSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">registerForRemoteNotifications</span><span class="p">)])</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">application</span> <span class="nf">registerForRemoteNotifications</span><span class="p">];</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="n">UIRemoteNotificationType</span> <span class="n">notificationTypes</span> <span class="o">=</span> <span class="n">UIRemoteNotificationTypeBadge</span> <span class="o">|</span> <span class="n">UIRemoteNotificationTypeSound</span> <span class="o">|</span> <span class="n">UIRemoteNotificationTypeAlert</span><span class="p">;</span>
    <span class="p">[</span><span class="n">application</span> <span class="nf">registerForRemoteNotificationTypes</span><span class="p">:</span><span class="n">notificationTypes</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div> <p>ps: 开发证书只能在Debug模式下运行，在release下只能使用生产证书。</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="/tags/#iOS" title="Pages tagged iOS" class="tag"><span class="term">iOS</span></a><a href="/tags/#APNs" title="Pages tagged APNs" class="tag"><span class="term">APNs</span></a><a href="/tags/#%E6%8E%A8%E9%80%81" title="Pages tagged 推送" class="tag"><span class="term">推送</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=/posts/2016/07/16/APNs%E6%8E%A8%E9%80%81/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=/posts/2016/07/16/APNs%E6%8E%A8%E9%80%81/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=/posts/2016/07/16/APNs%E6%8E%A8%E9%80%81/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <!-- /#commentit_thread 评论UI --> <section id="commentit_thread" class="animated fadeInUp"></section> </header> <!-- JS --> <script src="/assets/js/jquery-1.12.0.min.js"></script> <script src="/assets/js/jquery.dlmenu.min.js"></script> <script src="/assets/js/jquery.goup.min.js"></script> <script src="/assets/js/jquery.magnific-popup.min.js"></script> <script src="/assets/js/jquery.fitvid.min.js"></script> <script src="/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-83690324-2', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <!-- Comm(ent|it)评论加载 https://commentit.io/ --> <!-- 历史评论列表 --> 1 <div id="commentitList1" class="media"> <div class="media-left"> <img src="https://avatars.githubusercontent.com/u/11132222?v=3&amp;s=73" alt="wd910617"> </div> <div class="media-body"> <p class="text-muted"> <a href="https://github.com/wd910617">wd910617</a> on 05 Sep 2016 </p> <p>写的很好，学习了，👍，望继续出新的文章......</p> </div> </div> <script type="text/javascript"> (function() { document.getElementById('commentit_thread').appendChild(document.getElementById('commentitList1')); })(); </script> <!-- 发表评论 --> <noscript>Please enable JavaScript to view the comment form powered by <a href="https://commentit.io/">Comm(ent|it)</a>
</noscript> <div id="commentit"></div> <script type="text/javascript"> /** CONFIGURATION VARIABLES **/ var commentitUsername = 'myzerone'; var commentitRepo = 'myzerone/myzerone.github.io'; var commentitId = '/posts/2016/07/16/APNs推送'; /** DON'T EDIT FOLLOWING LINES **/ (function() { if (!document.getElementById('commentit_thread')) { return; }　 var commentit = document.createElement('script'); commentit.type = 'text/javascript'; commentit.async = true; commentit.src = 'https://commentit.io/static/embed/dist/commentit.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(commentit); document.getElementById('commentit_thread').appendChild(document.getElementById('commentit')); })(); </script> </body> </html>
