<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Objective-C 拾遗：Designated Initializer – myzerone</title> <meta name="description" content="记录下自己学习的过程、点滴，也为了分享自己的收获。"> <meta name="keywords" content="iOS, Designated Initializer"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="/assets/img/logo.png"> <meta name="twitter:title" content="Objective-C 拾遗：Designated Initializer"> <meta name="twitter:description" content="保证良好的编写Designated Initializer的风格，可以让我们节约很多时间，同时，可以有效的规避一些潜藏的Bug"> <!-- Open Graph --> <meta property="og:locale" content="zh_CN"> <meta property="og:type" content="article"> <meta property="og:title" content="Objective-C 拾遗：Designated Initializer"> <meta property="og:description" content="保证良好的编写Designated Initializer的风格，可以让我们节约很多时间，同时，可以有效的规避一些潜藏的Bug"> <meta property="og:url" content="/posts/2015/10/09/Objective-C-%E6%8B%BE%E9%81%97-Designated-Initializer/"> <meta property="og:site_name" content="myzerone"> <meta property="og:image" content="/assets/img/logo.png"> <!-- Webmaster Tools verfication --> <meta name="google-site-verification" content="Oq-I-tGK8y1zoHLnZQnfe7rH6rkjqyjqZfBtvADe2uU"> <link rel="canonical" href="/posts/2015/10/09/Objective-C-%E6%8B%BE%E9%81%97-Designated-Initializer/"> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="myzerone Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- JS --> <script src="/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="/favicon.png"> <link rel="shortcut icon" href="/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <!-- 首页 --> <li> <a href="/">首页</a> </li> <!-- 关于 --> <li> <a href="#">关于</a> <ul class="dl-submenu"> <li> <img src="/assets/img/logo.png" alt="myzerone photo" class="author-photo"> <h4>myzerone</h4> <p>记录下自己学习的过程、点滴，也为了分享自己的收获。</p> </li> <li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:myzerone@myzerone.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://github.com/myzerone" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <!-- 博客 --> <li> <a href="#">博客</a> <ul class="dl-submenu"> <li><a href="/posts/">博客</a></li> <li><a href="/tags/">标签</a></li> </ul> </li> <!-- 随笔 --> <li> <a href="/notes/" rel="noopener noreferrer">随笔</a> </li> <!-- 项目 --> <li> <a href="/projects/" rel="noopener noreferrer">项目</a> </li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Objective-C 拾遗：Designated Initializer</h1> <h4>09 Oct 2015</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~1 minute </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="id-objective-c-designated-initializer">Objective-C 拾遗：designated initializer</h1> <h2 id="id-designated-initializer">designated initializer是什么</h2> <blockquote> <p>The initializer of a class that takes the full complement of initialization parameters is usually the designated initializer. <sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p> </blockquote> <p>来自官方文档的介绍是designated initializer 通常是接收最多初始化参数的一个initializer。</p> <h2 id="id-designated-initializer-1">designated initializer的作用</h2> <p>一个类通常会有一个提供便利初始化的initializer,它通常接收最多的初始化参数。而这个initializer便通常是designated initializer,一个类里面最重要的initializer。主要的implementation都写在这里。其他initializer则调用它即可,不需要重复写相关代码。这个模式保证了所有的初始化方法都正确地初始实例变量。<br> 例如一个Task类，它有三个initializer</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">init</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithTitle</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">aTitle</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithTitle</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">aTitle</span> <span class="nf">date</span><span class="p">:(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDate</span><span class="p">;</span>
</code></pre></div> <p>则designated initializer便是</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithTitle</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">aTitle</span> <span class="nf">date</span><span class="p">:(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDate</span><span class="p">;</span>
</code></pre></div> <p>其他初始化方法则是convenience initializer,通过调用designated initializer或其他initializer来完成初始化工作。</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithTitle</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">aTitle</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">initWithTitle</span><span class="p">:</span><span class="n">aTitle</span> <span class="nf">date</span><span class="p">:[</span><span class="n">NSDate</span> <span class="nf">date</span><span class="p">]];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">init</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">initWithTitle</span><span class="p">:</span><span class="err">@”</span><span class="n">Task</span><span class="err">”</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div> <h2 id="id-designated-initializer-2">designated initializer的使用</h2> <p>一直以来,在Objective-C中,designated initializer是作为一个概念存在的,官方文档中希望我们能遵循这样的概念和规范。但是没有严格的语法进行限定,因此导致许多不知道这个概念或是贪方便的开发者没有进行严格的使用。<br> 在XCode6后,Objective-C新增了<code class="highlighter-rouge">NS_DESIGNATED_INITIALIZER</code>宏定义来进行规范。<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup><br> 使用了它之后:</p> <ol> <li>该designated initializer的实现一定要调用superclass的designated initializer方法。</li> </ol> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="c1">//声明：
</span><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithObject</span><span class="p">:(</span><span class="n">ObjectType</span><span class="p">)</span><span class="nv">object</span> <span class="n">NS_DESIGNATED_INITIALIZER</span><span class="p">;</span>
<span class="c1">//实现：
</span><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithNSString</span><span class="p">:(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">string</span> <span class="c1">//子类的designated initializer
</span><span class="p">{</span>   
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span> <span class="c1">//这里必须调用父类的designated initializer
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">......</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <ol> <li>没有标注为designated initializer的初始化方法都是convenience initializer。都需要调用自己的designated initializer。</li> </ol> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span> <span class="c1">//没有标注的初始化方法都是convenience initializer
</span><span class="p">{</span>   
	<span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">initWithObject</span><span class="p">:</span><span class="s">@"default string"</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div> <p>如果没有符合规范,编译器会出现Warnings。<br> 如果我们在一个类里采用了<code class="highlighter-rouge">NS_DESIGNATED_INITIALIZER</code>,则我们的所有初始化方法都要按照以上的规范进行。<br> 事实上 Swift同样也使用了designated initializer这样的概念。Objective-C中加入限制的宏,我们有理由相信这是为了配合Swift更严格的控制。<br> Swift更加严格地定义了designated initializer和它的使用规则。 详情可以查阅《The Swift Programming Language》。<br> 使用的规则是基本一致的，我们在OC也是遵循这样的规则的。</p> <blockquote> <p>Rule 1 A designated initializer must call a designated initializer from its immediate superclass.<br> Rule 2 A convenience initializer must call another initializer from the same class.<br> Rule 3 A convenience initializer must ultimately call a designated initialize.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup></p> </blockquote> <p>规则可以用这样一幅图显示: <img src="/assets/posts/DesignatedInitializer/%E5%9B%BE%E4%B8%80.png" alt="图一"></p> <h2 id="id-section">个人心得</h2> <p>在自己的开发过程中,合理地遵守和运用designated initializer会减少许多重复代码。<br> 并且理解了这一个概念,对整个Cocoa框架的理解也有帮助。 例如UIViewController的Designated initializer是:</p> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithNibName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibName</span>
                         <span class="nf">bundle</span><span class="p">:(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibBundle</span>
</code></pre></div> <p>但是可能有人会发现,如果你直接使用 [[viewController alloc]init]来生成Controller,且你是使用XIB来组织界面的,那么最后你得到的ViewController的View还是来自XIB的。<br> 这背后的原因就是Designated initializer帮你完成了这个工作。</p> <blockquote> <p>If you specify nil for the nibName parameter and you do not override the loadView method, the view controller searches for a nib file using other means.<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup></p> </blockquote> <p>文章来源：<a href="https://github.com/100mango/zen/blob/master/Objective-C%20%E6%8B%BE%E9%81%97%EF%BC%9Adesignated%20initializer/Objective-C%20%E6%8B%BE%E9%81%97%EF%BC%9Adesignated%20initializer.md">Objective-C 拾遗：designated initializer</a></p> <div class="footnotes"> <ol> <li id="fn:1"> <p><a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/DevPedia-CocoaCore/MultipleInitializers.html">Cocoa Core Competencies</a> <a href="#fnref:1" class="reversefootnote">↩</a></p> </li> <li id="fn:2"> <p><a href="https://developer.apple.com/library/ios/releasenotes/ObjectiveC/ModernizationObjC/AdoptingModernObjective-C/AdoptingModernObjective-C.html">Adopting Modern Objective-C</a> <a href="#fnref:2" class="reversefootnote">↩</a></p> </li> <li id="fn:3"> <p><a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/Initialization.html#//apple_ref/doc/uid/TP40014097-CH18-ID222"> Designated Initializers and Convenience Initializers</a> <a href="#fnref:3" class="reversefootnote">↩</a></p> </li> <li id="fn:4"> <p><a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewController_Class/index.html#//apple_ref/occ/instp/UIViewController/nibName">UIViewController Class Reference</a> <a href="#fnref:4" class="reversefootnote">↩</a></p> </li> </ol> </div> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="/tags/#iOS" title="Pages tagged iOS" class="tag"><span class="term">iOS</span></a><a href="/tags/#Designated%20Initializer" title="Pages tagged Designated Initializer" class="tag"><span class="term">Designated Initializer</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=/posts/2015/10/09/Objective-C-%E6%8B%BE%E9%81%97-Designated-Initializer/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=/posts/2015/10/09/Objective-C-%E6%8B%BE%E9%81%97-Designated-Initializer/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=/posts/2015/10/09/Objective-C-%E6%8B%BE%E9%81%97-Designated-Initializer/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <!-- /#commentit_thread 评论UI --> <section id="commentit_thread" class="animated fadeInUp"></section> </header> <!-- JS --> <script src="/assets/js/jquery-1.12.0.min.js"></script> <script src="/assets/js/jquery.dlmenu.min.js"></script> <script src="/assets/js/jquery.goup.min.js"></script> <script src="/assets/js/jquery.magnific-popup.min.js"></script> <script src="/assets/js/jquery.fitvid.min.js"></script> <script src="/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-83690324-2', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <!-- Comm(ent|it)评论加载 https://commentit.io/ --> <!-- 历史评论列表 --> 1 <div id="commentitList1" class="media"> <div class="media-left"> <img src="https://avatars.githubusercontent.com/u/11132222?v=3&amp;s=73" alt="wd910617"> </div> <div class="media-body"> <p class="text-muted"> <a href="https://github.com/wd910617">wd910617</a> on 05 Sep 2016 </p> <p>学习了&amp;mldr;&amp;mldr;</p> </div> </div> <script type="text/javascript"> (function() { document.getElementById('commentit_thread').appendChild(document.getElementById('commentitList1')); })(); </script> <!-- 发表评论 --> <noscript>Please enable JavaScript to view the comment form powered by <a href="https://commentit.io/">Comm(ent|it)</a>
</noscript> <div id="commentit"></div> <script type="text/javascript"> /** CONFIGURATION VARIABLES **/ var commentitUsername = 'myzerone'; var commentitRepo = 'myzerone/myzerone.github.io'; var commentitId = '/posts/2015/10/09/Objective-C 拾遗：Designated Initializer'; /** DON'T EDIT FOLLOWING LINES **/ (function() { if (!document.getElementById('commentit_thread')) { return; }　 var commentit = document.createElement('script'); commentit.type = 'text/javascript'; commentit.async = true; commentit.src = 'https://commentit.io/static/embed/dist/commentit.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(commentit); document.getElementById('commentit_thread').appendChild(document.getElementById('commentit')); })(); </script> </body> </html>
